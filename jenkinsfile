pipeline{
    agent any
    tools {maven "maven"}
    stages {
        stage('clone git') {
          steps{
            git branch: 'main', credentialsId: 'edc43311-5408-4645-8be5-df7162b7f887', url: 'https://github.com/nagadurga8/spring-petclinic.git'
          }
        }
          stage('Build') {
              steps {
                  sh 'mvn clean package'
                  
              }
          }
         // stage('sonarqube') {
         //   steps {
         //     withSonarQubeEnv('sonarqube') {
         //    sh 'mvn clean verify sonar:sonar \
         //       -Dsonar.projectKey=petclinic \
         //       -Dsonar.login=sqp_9e200dbe6b081c0995427414f0fac96bd132017e'
         //     }
         //   }
         // }
          stage('upload jar to nexus'){
            steps{
              script{
                def mavenPom = readmavenPom file: 'pom.xml'
                def nexusRepoName = mavenPom.version.endWith("SNAPSHOT") "simpleapp-snapshot" : "simpleapp-release"
              nexusArtifactUploader artifacts: [
                [
                  artifactId: 'spring-petclinic', 
                  classifier: '', 
                  file: "target/spring-petclinic-${mavenPom.version}.jar", 
                  type: 'jar'
                ]
              ], 
              credentialsId: 'neuxs', 
              groupId: 'org.springframework.samples', 
              nexusUrl: "54.167.105.114:8081", 
              nexusVersion: 'nexus3', 
              protocol: 'http', 
              repository: 'simpleapp-release', 
              version: "${mavenPom.version}"
            }
          }
    }
}